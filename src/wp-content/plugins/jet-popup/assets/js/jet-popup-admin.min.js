!function(i){"use strict";var e={init:function(){e.importInit(),i("#jet-popup-library-page")[0]&&e.presetLibraryInit(),i("#jet-popup-settings-page")[0]&&e.settingPageInit()},importInit:function(){var e=i("#jet-popup-import-trigger"),t=i("#jet-popup-create-trigger");if(!i("#wpbody-content .page-title-action")[0])return!1;i("#wpbody-content").find(".page-title-action:last").after(e),i("#wpbody-content").find(".page-title-action:last").after(t);tippy([e[0]],{html:document.querySelector("#jet-popup-import-form"),arrow:!0,placement:"bottom",flipBehavior:"clockwise",trigger:"click",interactive:!0,hideOnClick:!0,theme:"jet-popup-light"}),tippy([t[0]],{html:document.querySelector("#jet-popup-create-form"),arrow:!0,placement:"bottom",flipBehavior:"clockwise",trigger:"click",interactive:!0,hideOnClick:!0,theme:"jet-popup-light"})},presetLibraryInit:function(){Vue.config.devtools=!0,Vue.component("preset-filters",{template:"#preset-filters-template",props:{categories:Array,activeCategories:Array},data:function(){return{filterByValue:"date"}},methods:{filterByCategory:function(e,t){i.$emit("filterBycategory",e,t)},filterBy:function(e){this.filterByValue=e,i.$emit("filterBy",e)}}}),Vue.component("preset-list",{template:"#preset-list-template",props:{presets:Array},methods:{changePage:function(e){console.log(changePage)}}}),Vue.component("preset-item",{template:"#preset-item-template",props:{presetId:Number,title:String,thumbUrl:String,category:Array,categoryNames:Array,install:Number,required:Array,excerpt:String,details:Array,permalink:String},data:function(){return{modalShow:!1,requiredPluginData:window.jetPopupData.requiredPluginData}},computed:{categoryName:function(){var i="None";return 0!==this.categoryNames.length&&(i="",this.categoryNames.forEach(function(e,t){i+=e}),i=this.categoryNames.join(", ")),i},requiredPlugins:function(){var i=[],a=this.requiredPluginData;return this.required.forEach(function(e,t){a.hasOwnProperty(e)&&i.push(a[e])}),i}},methods:{openModal:function(){this.modalShow=!0},createPopup:function(){i.$emit("createPopup",this.presetId)}}}),Vue.component("presetlibrary",{template:"#preset-library-template",data:function(){return{spinnerShow:!0,presetsLoaded:!1,presetsLoadedError:!1,categoriesLoaded:!1,presetsData:[],categoryData:[],activeCategories:[],presetsLength:!1,page:1,perPage:8,preset:!1}},computed:{presetList:function(){var r=this.activeCategories,s=this.page,n=this.perPage,e=[];return e=this.presetsData.filter(function(e,t){var i=!1;for(var a in r)if(-1!==e.category.indexOf(r[a])){i=!0;break}return 0===r.length&&(i=!0),i}),this.presetsLength=e.length,e=e.filter(function(e,t){var i=!1,a=(s-1)*n;return a<=t&&t<a+n&&(i=!0),i})},isShowPagination:function(){return this.presetsLength>this.perPage}},methods:{filterByCategory:function(e,t){if(this.page=1,e)-1==this.activeCategories.indexOf(t)&&this.activeCategories.push(t);else{var i=this.activeCategories.indexOf(t);this.activeCategories.splice(i,1)}},filterBy:function(e){switch(this.page=1,e){case"date":this.presetsData.sort(function(e,t){return e.order-t.order});break;case"name":this.presetsData.sort(function(e,t){var i=e.title.toLowerCase(),a=t.title.toLowerCase();return a<i?1:i<a?-1:0});break;case"popular":this.presetsData.sort(function(e,t){return t.install-e.install})}},changePage:function(e){this.page=e}},created:function(){var e=window.jetPopupData.libraryPresetsUrl,t=window.jetPopupData.libraryPresetsCategoryUrl,a=[],r=[],s=this;axios.get(e).then(function(e){var t=e.data;if(t.success){for(var i in t.presets){var a=t.presets[i];r.push({id:a.id,title:a.title,thumb:a.thumb,category:a.category,categoryNames:a.category_names,order:a.order,install:+a.install,required:a.required,excerpt:a.excerpt,details:a.details,permalink:a.permalink})}s.presetsData=r,s.spinnerShow=!1,s.presetsLoaded=!0}else s.spinnerShow=!1,s.presetsLoadedError=!0}).catch(function(e){s.spinnerShow=!1,s.presetsLoadedError=!0,s.presetsData=[]}),axios.get(t).then(function(e){var t=e.data;if(t.success){for(var i in t.categories)a.push({id:i,label:t.categories[i],state:!1});s.categoryData=a}s.categoriesLoaded=!0}).catch(function(e){s.categoryData=[]}),i.$on("createPopup",function(e){s.preset=e,setTimeout(function(){s.$refs.jetPopupLibraryForm.submit()},100)}),i.$on("filterBycategory",function(e,t){s.filterByCategory(e,t)}),i.$on("filterBy",function(e){s.filterBy(e)})}});var i=new Vue;new Vue({el:"#jet-popup-library-page"})},settingPageInit:function(){Vue.config.devtools=!0,Vue.component("mailchimp-list-item",{template:"#mailchimp-list-item-template",props:{list:Object,apikey:String},data:function(){return{mergeFieldsStatusLoading:!1}},computed:{isMergeFields:function(){return!(!this.list.hasOwnProperty("mergeFields")||jQuery.isEmptyObject(this.list.mergeFields))}},methods:{getMergeFields:function(){var a=this;jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"get_mailchimp_list_merge_fields",apikey:this.apikey,listid:this.list.id},beforeSend:function(e,t){a.mergeFieldsStatusLoading=!0},error:function(e,t,i){},success:function(e,t,i){switch(a.mergeFieldsStatusLoading=!1,e.type){case"success":a.$Notice.success({title:e.title,desc:e.desc}),l.$emit("updateListMergeFields",e.request);break;case"error":a.$Notice.error({title:e.title,desc:e.desc})}}})}}}),Vue.component("settingsform",{template:"#settings-form-template",data:function(){return{modalSave:!1,saveStatusLoading:!1,syncStatusLoading:!1,mergeFieldsStatusLoading:!1,collapse:"mailChimpPanel",settingsData:{apikey:""},mailchimpAccountData:{},mailchimpListsData:{}}},computed:{isMailchimpAccountData:function(){return!jQuery.isEmptyObject(this.mailchimpAccountData)},isMailchimpListsData:function(){return!jQuery.isEmptyObject(this.mailchimpListsData)}},created:function(){var s=this,e=window.jetPopupAdminData.settings,t=window.jetPopupAdminData.mailchimpApiData;if(this.settingsData=e,t.hasOwnProperty(e.apikey)){var i=t[e.apikey];if(i.hasOwnProperty("account")){var a=i.account;this.mailchimpAccountData={account_id:a.account_id,username:a.username||"-",first_name:a.first_name||"-",last_name:a.last_name||"-",avatar_url:a.avatar_url}}if(i.hasOwnProperty("lists")){var r=i.lists,n={};if(!jQuery.isEmptyObject(r))for(var o in r){var c=r[o].info,u=r[o].merge_fields||[],p={};u.forEach(function(e,t,i){p[e.tag]=e.name}),n[o]={id:c.id,name:c.name,memberCount:c.stats.member_count,doubleOptin:c.double_optin,dateCreated:c.date_created,mergeFields:p}}this.mailchimpListsData=n}}l.$on("updateListMergeFields",function(e){var t=e.list_id,i=e.merge_fields,a={};for(o in i){var r=i[o];a[r.tag]=r.name}Vue.set(s.mailchimpListsData[t],"mergeFields",a)})},methods:{mailchimpSync:function(){var r=this;jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"get_mailchimp_user_data",apikey:this.settingsData.apikey},beforeSend:function(e,t){r.syncStatusLoading=!0},error:function(e,t){},success:function(e,t,i){switch(e.type){case"success":var a=e.request;r.$Notice.success({title:e.title,desc:e.desc}),r.mailchimpAccountData={account_id:a.account_id,username:a.username||"-",first_name:a.first_name||"-",last_name:a.last_name||"-",avatar_url:a.avatar_url},r.mailchimpSyncLists();break;case"error":r.syncStatusLoading=!1,r.$Notice.error({title:e.title,desc:e.desc})}}})},mailchimpSyncLists:function(){var c=this;jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"get_mailchimp_lists",apikey:this.settingsData.apikey},beforeSend:function(e,t){c.syncStatusLoading=!0},error:function(e,t){},success:function(e,t,i){switch(c.syncStatusLoading=!1,e.type){case"success":c.$Notice.success({title:e.title,desc:e.desc});var a=e.request;if(a.hasOwnProperty("lists")){var r=a.lists,s={};for(var n in r){var o=r[n];s[o.id]={id:o.id,name:o.name,memberCount:o.stats.member_count,doubleOptin:o.double_optin,dateCreated:o.date_created}}c.mailchimpListsData=s}break;case"error":c.$Notice.error({title:e.title,desc:e.desc})}}})},saveSettings:function(){var a=this,e={action:"jet_popup_save_settings",data:this.settingsData};jQuery.ajax({type:"POST",url:ajaxurl,data:e,beforeSend:function(e,t){a.saveStatusLoading=!0},error:function(e,t,i){},success:function(e,t,i){switch(a.saveStatusLoading=!1,e.type){case"success":a.$Notice.success({title:e.title,desc:e.desc});break;case"error":a.$Notice.error({title:e.title,desc:e.desc})}}})},openSaveModal:function(){this.modalSave=!0}}});var l=new Vue;new Vue({el:"#jet-popup-settings-page"})}};e.init()}(jQuery);